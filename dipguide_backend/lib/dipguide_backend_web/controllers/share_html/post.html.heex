<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Swim report Â· {@post.location_name}</title>

    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="Dip Report" />
    <meta
      property="og:title"
      content={DipguideBackendWeb.ShareView.og_title(@post, @post_time, @weather)}
    />
    <meta
      property="og:description"
      content={DipguideBackendWeb.ShareView.description(@post, @post_time, @weather)}
    />
    <meta property="og:url" content={@share_url} />
    <meta property="og:updated_time" content={DateTime.to_iso8601(@post_time)} />
    <%= if @og_image_url do %>
      <meta property="og:image" itemprop="image" content={@og_image_url} />
      <meta property="og:image:width" content="1200" />
      <meta property="og:image:height" content={if @image_url, do: "900", else: "630"} />
      <meta property="og:image:type" content="image/png" />
    <% end %>

    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content={DipguideBackendWeb.ShareView.og_title(@post, @post_time, @weather)}
    />
    <meta
      name="twitter:description"
      content={DipguideBackendWeb.ShareView.description(@post, @post_time, @weather)}
    />
    <%= if @og_image_url do %>
      <meta name="twitter:image" content={@og_image_url} />
    <% end %>

    <style>
      * { box-sizing: border-box; }
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #0f172a; color: #f8fafc; -webkit-font-smoothing: antialiased; }
      a.page-link { display: block; text-decoration: none; color: inherit; cursor: pointer; min-height: 100vh; }

      /* Header */
      .header { height: 56px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid rgba(148,163,184,0.12); background: #0f172a; }
      .header-inner { width: min(560px, 100%); padding: 0 16px; display: flex; align-items: center; gap: 10px; }
      .logo { font-size: 22px; }
      .loc-name { font-weight: 700; font-size: 15px; color: #f8fafc; }

      /* Content */
      .wrap { max-width: 560px; margin: 0 auto; padding: 16px; }

      /* Weather row â€” matching the app's _HourlyRow */
      .forecast-row {
        display: flex; align-items: center; gap: 0;
        background: #1e293b; border-radius: 10px;
        border-left: 4px solid #3b82f6;
        padding: 12px 10px;
      }
      .col { display: flex; flex-direction: column; align-items: center; justify-content: center; }
      .col-left { align-items: flex-start; }

      .col-time { flex: 0 0 60px; }
      .time-val { color: #60a5fa; font-weight: 700; font-size: 15px; }

      .col-weather { flex: 1; }
      .temp-row { display: flex; align-items: center; justify-content: center; gap: 4px; }
      .temp-icon { font-size: 18px; }
      .temp-val { font-size: 18px; font-weight: 800; color: #f8fafc; }
      .wind-val { font-size: 12px; color: #94a3b8; margin-top: 2px; }
      .rain-val { font-size: 10px; color: #38bdf8; margin-top: 1px; }

      .col-swell { flex: 1; }
      .swell-ht { font-size: 15px; font-weight: 800; color: #a78bfa; display: flex; align-items: center; gap: 3px; }
      .swell-arrow { font-size: 13px; color: #a78bfa; }
      .sea-temp { font-size: 14px; font-weight: 700; color: #4cc9f0; margin-top: 2px; }
      .wave-period { font-size: 11px; color: #94a3b8; margin-top: 1px; }

      .col-condition { flex: 0 0 56px; }
      .roughness-badge {
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        width: 48px; height: 48px; border-radius: 12px;
      }
      .rough-icon { font-size: 22px; }
      .rough-pct { font-weight: 800; font-size: 11px; margin-top: 1px; }

      /* Photo */
      .photo-section { margin-top: 14px; display: flex; justify-content: center; }
      .photo { width: 100%; max-width: 520px; border-radius: 12px; border: 1px solid rgba(148,163,184,0.15); }

      /* Comment & meta */
      .comment { margin-top: 12px; color: #e2e8f0; font-size: 15px; line-height: 1.45; text-align: center; }
      .meta { margin-top: 8px; color: #64748b; text-align: center; font-size: 12px; }

      /* CTA */
      .cta-row { display: flex; justify-content: center; margin-top: 20px; }
      .cta-btn { background: #2563eb; color: #fff; padding: 12px 22px; border-radius: 12px; font-weight: 800; font-size: 15px; }
    </style>
  </head>
  <body>
    <%= if @og_image_url do %>
      <link itemprop="thumbnailUrl" href={@og_image_url} />
      <span itemprop="thumbnail" itemscope itemtype="http://schema.org/ImageObject">
        <link itemprop="url" href={@og_image_url} />
      </span>
    <% end %>
    <a class="page-link" href={@open_url}>
      <header class="header">
        <div class="header-inner">
          <div class="logo">ðŸŒŠ</div>
          <div class="loc-name">{@post.location_name}</div>
        </div>
      </header>

      <div class="wrap">
        <!-- Weather row matching app design -->
        <div class="forecast-row">
          <div class="col col-time">
            <span class="time-val">{DipguideBackendWeb.ShareView.time_label(@post_time)}</span>
          </div>

          <div class="col col-weather">
            <div class="temp-row">
              <span class="temp-icon">{DipguideBackendWeb.ShareView.weather_icon(@weather)}</span>
              <span class="temp-val">{DipguideBackendWeb.ShareView.format_temp(@weather)}</span>
            </div>
            <span class="wind-val">{DipguideBackendWeb.ShareView.format_wind_compact(@weather)}</span>
            <span class="rain-val">ðŸ’§{DipguideBackendWeb.ShareView.format_rain_compact(@weather)}</span>
          </div>

          <div class="col col-swell col-left">
            <div class="swell-ht">
              {DipguideBackendWeb.ShareView.format_wave_height(@weather)}
              <span class="swell-arrow">{DipguideBackendWeb.ShareView.wave_arrow(@weather)}</span>
            </div>
            <span class="sea-temp">{DipguideBackendWeb.ShareView.format_wave_period(@weather)}</span>
          </div>

          <div class="col col-condition">
            <div class="roughness-badge" style={"background:#{DipguideBackendWeb.ShareView.roughness_bg(@weather)}"}>
              <span class="rough-icon">{DipguideBackendWeb.ShareView.roughness_icon(@weather)}</span>
              <span class="rough-pct" style={"color:#{DipguideBackendWeb.ShareView.roughness_color(@weather)}"}>{DipguideBackendWeb.ShareView.roughness_pct(@weather)}</span>
            </div>
          </div>
        </div>

        <%= if @image_url do %>
          <div class="photo-section">
            <img class="photo" src={@image_url} alt="Swim spot" />
          </div>
        <% end %>

        <%= if @post.comment && String.trim(@post.comment) != "" do %>
          <div class="comment">{@post.comment}</div>
        <% end %>

        <div class="meta">{Calendar.strftime(@post_time, "%a %d %b Â· %H:%M UTC")}</div>

        <div class="cta-row">
          <span class="cta-btn">Open full forecast â†’</span>
        </div>
      </div>
    </a>
  </body>
</html>
